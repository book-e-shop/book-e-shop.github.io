# Лабораторная работа 7. Углубленная работа с данными
# Лабораторная работа 8. Лабораторная работа 8. Переделываем результат 5 ЛР (CRUD 2 таблиц) на ajax и работу в режиме single page application.
[Ссылка на github (дамп базы там же)](https://github.com/book-e-shop/book-e-shop/)

## [Структура данных](https://github.com/book-e-shop/book-e-shop.github.io/blob/master/img/lab5/db.png)

<img  src = "img/lab5/db.png">

## Сценарии работы и представления

####  Корзина. Сценарии работы.

1. Авторизованному пользователю предоставляется возможность добавления книг в корзину.
2. Нажав на книгу, пользователь попадает на отдельную старницу книги, где присутствует кнопка "Добавить".
3. При нажатии на кнопку выбранная книга попадает в корзину.
4. Чтобы попасть в корзину, необходимо нажать значок корзины в верхней части страницы.
5. При необходимости существует возможность редактировать содержимое будущего заказа.

Технически, корзина представляет собой php-массив, который хранится в переменной **$_SESSION** и содержит **id** добавленных в корзину книг.

##### Скринкаст добавления товаров в корзину

<video  muted controls  width="800" height="450" src = "videos/lab7-8/basket.mp4"></video>

####  Таблица "Заказы". Сценарии работы.

1. Для оформления заказа необходимо нажать кнопку "Оформить заказ" в корзине. 
2. После этого откроется форма оформления заказа. В поля Фамилия, Отчество, Почта автоматически подтянулся данные из таблицы **users** для текущего авторизованного пользователя. Самостоятельно необходимо будет указать адрес доставки и выбрать способ оплаты, если не устраивает текущий.
3. Для заверешения оформления заказа необходимо нажать кнопку "Оформить заказ". После этого в таблицу **orders** будут добавлены данные о заказе.
4. Увидеть заказы пользователя можно в личном кабинете.

##### Скринкаст оформления заказа

<video  muted controls  width="800" height="450" src = "videos/lab7-8/order.mp4"></video>

####  Таблица "Комментарии". Сценарии работы.
Авторизованные пользователи могут писать комментарии для книг.

1. На странице с отдельной книгой отображаются все комментарии, оставленные для этой книги.
2. Для добавления комментария необходимо написать тескт в соответсвующем поле и нажать кнопку "Добавить".
3. Если пользователь авторизован, то отображаются две кнопки "Удалить" и "Редактировать".
4. Для удаления комментария необходимо нажать на кнопку "Удалить".
5. Текстовое поля для редактирования комментария становится активным после нажатия на кнопку "Редактировать".Для подтверждения изменений нажать на появившуюся кнопку "Обновить".

Работа с таблицей осуществляется в режиме single page application.
##### Скринкаст работы с комментариями
<video  muted controls  width="800" height="450" src = "videos/lab7-8/comments.mp4"></video>


####  Таблица "Рейтинг". Сценарии работы.
Авторизованные пользователи могут ставить оценки для книг.

1. Для добавления оценки необходимо установить галочку в check box, который соответствует оценке.
2. Для удаление оценки необходимо снять ранее установленную галочку.
3. Для изменении оценки необходимо установить галочку в check box, который соответствует новой оценке.
4. Для отображение рейтинга книги используется два блока:
    * Первый блок отображает среднюю оценку для книги. Оценка вычисляется по формуле:  Сумма оценок для книги/Количество оценок для книги .
    * Второй блок отображает распределение оценок для книги.
Работа с таблицей осуществляется в режиме single page application.

##### Скринкаст работы с рейтингом книги
<video  muted controls  width="800" height="450" src = "videos/lab7-8/rating.mp4"></video>


####  Таблица "Логи". Сценарии работы.
Для отслеживания действий пользователся используется таблица "Логи".
1. В таблицу "Логи" представленая следующими полями:
    * *user_id* — id пользователя, совершившего действие  *action*.
    * *action* — действие пользователя: 'Чтение','Добавление','Удаление','Редактирование'.
    * *table* — таблица, которая учавствовала в действии  *action*.
    * *table_id* — id записи (в таблице *table*), над которой было выполнено действие *action*.
    * *publish_date* — время фиксации действия пользователя.
2. Для добавление записи в таблицу "Логи" используется функция *add_log($table, $table_id, $action, $user_id)*.
3. Логи отображаются только для администратора.

Работа с таблицей осуществляется в режиме single page application.

## Отчеты

####  Отчет для таблицы "Логи".

1. Отчет доступен для администратора и расположен по ссылке [http://localhost/admin.php](http://localhost/admin.php).
2. Отчет параметризован параметрами: *user_id*, *action*, *table*, *table_id*,*date1*,*date2*. Параметры *date1* и *date2* манипулируют полем *publish_date*, и позволяют выбрать логи между двумя датами.
##### Скринкаст работы с отчетом
<video  muted controls  width="800" height="450" src = "videos/lab7-8/report-logs.mp4"></video>

####  Отчет для таблицы "Комментарии".

1. Отчет доступен для администратора и расположен по ссылке [http://localhost/admin.php](http://localhost/admin.php).
2. Отчет параметризован параметрами: *user_id*, *book_id*, *date1*,*date2*. Параметры *date1* и *date2* манипулируют полем *publish_date*, и позволяют выбрать комментарии между двумя датами.
##### Скринкаст работы с отчетом
<video  muted controls  width="800" height="450" src = "videos/lab7-8/report-comments.mp4"></video>